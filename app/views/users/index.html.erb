<!-- Admin or @user logic -->
<% if current_user.admin? %>

	<div class="container">
		<!-- Search bar -->
		<%= simple_form_for :search, url: users_path, method: :get do |f| %>
		  <div class="search-form-control form-group">
				<%= text_field_tag :query,
			    params[:query],
			    class: "form-control string required",
			    type: "text",
			    id: "search_query",
			    placeholder: "Find a user"
		  	%>
		    <button name="button" type="submit" class="btn btn-primary">
		      <i class="fas fa-search"></i> Search
		    </button>
		  </div>
		</div>
	<% end %>
	<br>
	
	<% @users.each do |user| %>
		
		<% if user.promotions.empty? %>
			<%=  %>
		<% elsif user.promotions.last.promoted_at == nil %> 
			<% last_promotion = user.promotions.last.created_at %>
		<% else %>
			<% last_promotion = user.promotions.last.promoted_at %>
		<% end %>

		<div class="index-card">
			<%= link_to user_path(user) do %>
				<div class="flex-grid">
					<div class="flex-col item1">
						<% if user.photo.attached? %>
					         <%= cl_image_tag user.photo.key, :transformation=>[
					            {:width=>200, :height=>200, :gravity=>"face", :radius=>"max", :crop=>"thumb"},
					            {:width=>200, :crop=>"scale"}
					            ], 
					            class: "user-avatar", alt: "user-avatar" %>
					  <% else %>
							<div class="default-avatar">
								<%= image_tag "default_avatar_square.png", class: "user-avatar", alt: "user-avatar" %>
							</div>
					  <% end %>
					</div>
				
					<div class="flex-col name-item">
						<h5><%= user.first_name %> <%= user.last_name %></h5>
					</div>
					<div class="flex-col">
						<!-- empty placeholder -->
					</div>
					<div class="flex-col">
						<% if user.promotions.empty? %>
							<p>Add belt</p>
						<% else %>
						<p><%= user.promotions.last.belt %></p>
						<% end %>
					</div>
					<div class="flex-col">
						<% if user.promotions.empty? %>
							<p>No promotions</p>
						<% else %>
							<p class="card-text">Prom last:
								<% if ((Date.today.year * 12 + Date.today.month) - (last_promotion.year * 12 + last_promotion.month).to_i) > 6 %>
				    			<strong class="red"><%= user.date_diff(last_promotion, Date.today) %></strong>
				    		<% else %>
				    			<strong class="green"><%= user.date_diff(last_promotion, Date.today) %></strong>
				    		<% end %>
						  </p>
						<% end %>
					</div>
					<div class="flex-col measurements">
						<div id="weight">
							<p>Weight: <%= user.weight %>kg</p>
							<p>Height: <%= user.height %>cm</p>
						</div>
					</div>
				</div>
			<% end %>
		</div>
	<% end %>
	<br>

<% else %>
	<h2>No Access</h2>
	<p>This page is an admin-only page.</p>

	<%= link_to "Your Profile", user_path(current_user), class: "btn btn-primary" %>
	<%= link_to "Home Page", root_path, class: "btn btn-primary" %>
<% end %>
<!-- Admin or @user logic -->


